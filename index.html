<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Indemnizaciones Laborales (Argentina)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LIBRERÍA PDF (CARGA GLOBAL) -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <!-- Librerías de Firebase (Carga Modular V9 para GitHub Pages) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, addDoc, getDocs, where, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('debug');

        // Configuraciones de entorno
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigRaw = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const firebaseConfig = JSON.parse(firebaseConfigRaw);
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 
        
        // Variables de la aplicación
        let app = null;
        let db = null;
        let auth = null;
        let currentUser = { uid: 'local_user' };
        let currentLiquidationResult = null;
        let currentDifferencesResult = null; // Nuevo resultado para diferencias salariales
        
        // Determina si estamos en modo local sin configuración de Firebase
        const isLocalMode = !firebaseConfig.apiKey; 

        // --- UTILS UI ---
        const showSpinner = (show) => {
            document.getElementById('loading-spinner').classList.toggle('hidden', !show);
        };

        const showModal = (title, content, type = 'error') => {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-content').innerHTML = content;
            const titleElement = document.getElementById('modal-title');
            titleElement.classList.toggle('text-red-600', type === 'error');
            titleElement.classList.toggle('text-blue-600', type === 'info');
            document.getElementById('modal').classList.remove('hidden');
        };

        const hideModal = () => {
            document.getElementById('modal').classList.add('hidden');
        };
        
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(amount);
        };
        
        // Función de navegación de pestañas
        const changeTab = (tabName) => {
            document.getElementById('indemnizacion-tab').classList.add('hidden');
            document.getElementById('diferencias-salariales-tab').classList.add('hidden');
            
            document.getElementById('btn-indemnizacion').classList.remove('bg-red-600', 'text-white');
            document.getElementById('btn-indemnizacion').classList.add('text-red-600', 'hover:bg-gray-100');
            
            document.getElementById('btn-diferencias').classList.remove('bg-red-600', 'text-white');
            document.getElementById('btn-diferencias').classList.add('text-red-600', 'hover:bg-gray-100');


            if (tabName === 'indemnizacion') {
                document.getElementById('indemnizacion-tab').classList.remove('hidden');
                document.getElementById('btn-indemnizacion').classList.add('bg-red-600', 'text-white');
                document.getElementById('btn-indemnizacion').classList.remove('text-red-600', 'hover:bg-gray-100');
            } else if (tabName === 'diferencias') {
                document.getElementById('diferencias-salariales-tab').classList.remove('hidden');
                document.getElementById('btn-diferencias').classList.add('bg-red-600', 'text-white');
                document.getElementById('btn-diferencias').classList.remove('text-red-600', 'hover:bg-gray-100');
            }
        };


        // Esta función solo se usará si 'db' está inicializado
        const getLiquidationCollectionRef = () => collection(db, `artifacts/${appId}/users/${currentUser.uid}/liquidations`);

        // --- AUTH & UI LOGIC ---
        const handleAuth = async () => {
            showSpinner(true);
            
            if (isLocalMode) {
                // Modo local
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('user-info').innerText = `ID de Sesión: MODO LOCAL`;
                loadHistory(); 
                changeTab('indemnizacion'); // Inicializar en la primera pestaña
                showSpinner(false);
                return;
            }
            
            // Modo Canvas / Producción: Inicializar Firebase
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Init Error:", error);
                showModal("Error de Inicialización", "No se pudo conectar a la base de datos o autenticar. Verifique la consola para detalles.");
            }
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    currentUser = user;
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    const displayId = user.isAnonymous ? 'Anónimo' : `${currentUser.uid.substring(0, 8)}...`;
                    document.getElementById('user-info').innerText = `ID de Sesión: ${displayId}`;
                    loadHistory();
                    changeTab('indemnizacion'); // Inicializar en la primera pestaña
                } 
                showSpinner(false);
            });
        };

        const handleLogout = async () => {
            if (isLocalMode) return; 
            
            showSpinner(true);
            try {
                await signOut(auth);
                await signInAnonymously(auth); 
            } catch (error) {
                console.error("Logout Error:", error);
            }
        };
        // --- END AUTH LOGIC ---

        // --- CÁLCULO DE ANTIGÜEDAD Y DÍAS TRABAJADOS (Liquidación) ---
        const getDaysInYear = (year) => (year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0)) ? 366 : 365;
        
        const getBaseVacationDays = (completedYears) => {
            if (completedYears >= 20) return 35;
            if (completedYears >= 10) return 28;
            if (completedYears >= 5) return 21;
            if (completedYears >= 0.5) return 14; 
            return 0; 
        };

        const calculateAntiquity = (startDate, endDate) => {
            const start = new Date(startDate);
            const end = new Date(endDate);

            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();

            if (days < 0) {
                months--;
                days += new Date(end.getFullYear(), end.getMonth(), 0).getDate();
            }

            if (months < 0) {
                years--;
                months += 12;
            }

            const startOfYear = new Date(end.getFullYear(), 0, 1);
            const daysInYear = Math.ceil((end - startOfYear) / (1000 * 60 * 60 * 24)) + 1; 
            
            const semesterStartMonth = (end.getMonth() + 1 <= 6) ? 0 : 6;
            const startOfSemester = new Date(end.getFullYear(), semesterStartMonth, 1);
            const daysInSemester = Math.ceil((end - startOfSemester) / (1000 * 60 * 60 * 24)) + 1; 

            // Regla del art. 245 LCT (Antigüedad Computable para Indemnización)
            let yearsForIndemnity = years;
            if (months > 3 || (months === 3 && days >= 1)) {
                yearsForIndemnity++;
            }
            if (yearsForIndemnity === 0 && (months > 0 || days > 0)) {
                yearsForIndemnity = 1; 
            }

            return {
                years, 
                months,
                days,
                yearsForIndemnity, 
                daysInYear, 
                daysInSemester 
            };
        };

        // --- CÁLCULO DE RUBROS Y MULTAS (Liquidación) ---
        const calculateSeverance = () => {
            // Datos del Empleado
            const sueldo = parseFloat(document.getElementById('sueldo').value) || 0;
            const topeSalarialInput = document.getElementById('tope-salarial').value;
            const topeSalarial = topeSalarialInput ? parseFloat(topeSalarialInput) : sueldo; 
            
            const fechaIngreso = document.getElementById('fecha-ingreso').value;
            const fechaEgreso = document.getElementById('fecha-egreso').value || new Date().toISOString().substring(0, 10);
            const jornada = parseFloat(document.getElementById('jornada').value) || 8;
            const fine25323_2 = document.getElementById('fine-25323-2').checked;
            const fine25323_1 = document.getElementById('fine-25323-1').checked;
            const fineArt80 = document.getElementById('fine-art-80').checked; 

            const resultDiv = document.getElementById('result-summary');

            if (!fechaIngreso || sueldo <= 0 || jornada <= 0) {
                resultDiv.innerHTML = '<p class="text-red-500 font-bold">Por favor, complete la Fecha de Ingreso, Sueldo y Jornada.</p>';
                return;
            }

            const { years, yearsForIndemnity, daysInYear, daysInSemester } = calculateAntiquity(fechaIngreso, fechaEgreso);
            const proportionalityFactor = jornada / 8;
            const workingDaysInYear = getDaysInYear(new Date(fechaEgreso).getFullYear());

            // 1. BASE INDEMNIZATORIA 
            const baseIndemnizatoria245 = Math.min(sueldo, topeSalarial);

            // 2. Indemnización por Antigüedad (Art. 245)
            const indemAntiguedadBruto = baseIndemnizatoria245 * yearsForIndemnity;

            // 3. Indemnización por Preaviso (Art. 231-232)
            let mesesPreaviso = (years < 5) ? 1 : 2;
            const indemPreavisoBruto = sueldo * mesesPreaviso; 

            // 4. Integración Mes de Despido (Simplificado)
            const indemIntegracion = sueldo / 30; 

            // 5. Sueldo Anual Complementario (SAC) Proporcional
            const sacProporcionalBruto = (sueldo / 2) * (daysInSemester / 182.5);

            // 6. Vacaciones No Gozadas Proporcionales (LCT Art. 156)
            const baseVacationDays = getBaseVacationDays(years); 
            const proportionalDays = (baseVacationDays / workingDaysInYear) * daysInYear; 
            const vacacionesNoGozadasBruto = (sueldo / 25) * proportionalDays; 

            // Subtotal de Rubros Remunerativos e Indemnizatorios Base
            const subTotalBase = indemAntiguedadBruto + indemPreavisoBruto + indemIntegracion + sacProporcionalBruto + vacacionesNoGozadasBruto;
            
            // MULTAS LCT (Ley 25.323 y Art. 80)
            let totalMultas = 0;
            let multa25323_2 = 0;
            let indemArt80 = 0; 

            if (fine25323_2) {
                multa25323_2 = (indemAntiguedadBruto + indemPreavisoBruto) * 0.5; 
                totalMultas += multa25323_2;
            }

            if (fineArt80) {
                indemArt80 = sueldo * 3;
                totalMultas += indemArt80;
            }

            const multa25323_1 = (fine25323_1) ? subTotalBase * 0.10 : 0; 
            totalMultas += multa25323_1;

            // TOTAL FINAL
            const totalLiquidacionSinProporcional = subTotalBase + totalMultas;
            const totalLiquidacion = totalLiquidacionSinProporcional * proportionalityFactor;


            currentLiquidationResult = {
                sueldo,
                topeSalarial,
                fechaIngreso,
                fechaEgreso,
                years,
                yearsForIndemnity,
                baseIndemnizatoria245,
                indemAntiguedad: indemAntiguedadBruto,
                indemPreaviso: indemPreavisoBruto,
                indemIntegracion: indemIntegracion,
                sacProporcional: sacProporcionalBruto,
                vacacionesNoGozadas: vacacionesNoGozadasBruto,
                multa25323_2: multa25323_2,
                multa25323_1: multa25323_1,
                indemArt80: indemArt80,
                totalMultas: totalMultas,
                totalLiquidacion: totalLiquidacion,
                proportionalityFactor,
                baseVacationDays: baseVacationDays,
                proportionalDays: proportionalDays.toFixed(2)
            };

            // Mostrar Resultados
            resultDiv.innerHTML = `
                <div class="space-y-3">
                    <h3 class="text-xl font-bold text-blue-700 border-b pb-2">Resumen de Liquidación Detallado</h3>
                    <div class="flex justify-between pb-1 text-sm text-gray-700">
                        <span class="font-medium">Antigüedad Computable (Art. 245):</span>
                        <span>${yearsForIndemnity} Años</span>
                    </div>
                    <!-- ... (resto del resumen de liquidación) ... -->
                    <hr class="my-4 border-gray-500">
                    <div class="flex justify-between items-center bg-red-100 p-3 rounded-lg">
                        <span class="text-2xl font-extrabold text-red-800">TOTAL ESTIMADO:</span>
                        <span class="text-3xl font-extrabold text-red-800">${formatCurrency(totalLiquidacion)}</span>
                    </div>
                    <p class="text-xs text-red-500 mt-2">Este total ya aplica la proporción de la jornada laboral.</p>
                </div>
            `;

            document.getElementById('pdf-button').classList.remove('opacity-50', 'pointer-events-none');
        };
        
        // --- CÁLCULO DE DIFERENCIAS SALARIALES ---
        const calculateSalaryDifferences = () => {
            const sueldoBrutoMensual = parseFloat(document.getElementById('sueldo-mensual').value) || 0;
            const mesesAReclamar = parseInt(document.getElementById('meses-reclamar').value) || 0;
            const horaEntrada = document.getElementById('hora-entrada').value;
            const horaSalida = document.getElementById('hora-salida').value;
            const feriadosTrabajados = parseInt(document.getElementById('feriados-trabajados').value) || 0;
            const horasExtrasNormales = parseFloat(document.getElementById('horas-extras-normales').value) || 0;
            const horasExtrasFeriado = parseFloat(document.getElementById('horas-extras-feriado').value) || 0;


            const resultDiv = document.getElementById('result-diferencias');

            if (sueldoBrutoMensual <= 0 || mesesAReclamar <= 0 || !horaEntrada || !horaSalida) {
                resultDiv.innerHTML = '<p class="text-red-500 font-bold">Por favor, complete todos los campos requeridos para el cálculo de Diferencias Salariales.</p>';
                return;
            }

            // Cálculo del valor de la hora normal (simplificado a 200 horas/mes)
            const valorHoraNormal = sueldoBrutoMensual / 200; 

            // --- LÓGICA DE HORAS NOCTURNAS (21:00 a 06:00) ---
            const NOCHE_INICIO = 21;
            const NOCHE_FIN = 6;
            const ADICIONAL_NOCTURNO = 0.1333; // 13.33%

            const entrada = parseInt(horaEntrada.split(':')[0]);
            const salida = parseInt(horaSalida.split(':')[0]);
            const jornadaCompleta = (salida > entrada) ? (salida - entrada) : (24 - entrada + salida);

            // Calcular horas nocturnas por día
            let horasNocturnasPorDia = 0;

            for (let i = 0; i < jornadaCompleta; i++) {
                let horaActual = (entrada + i) % 24;

                // Si la hora actual cae entre 21:00 y 05:59 (nocturna)
                if (horaActual >= NOCHE_INICIO || horaActual < NOCHE_FIN) {
                    horasNocturnasPorDia++;
                }
            }

            // Horas diurnas
            const horasDiurnas = jornadaCompleta - horasNocturnasPorDia;

            // La ley establece que 8 horas nocturnas equivalen a 7 horas de trabajo efectivo.
            // Reducción de jornada nocturna (13.33% de reducción en tiempo, o 13.33% de adicional)
            const factorReduccionJornada = 8 / 7.5; // Aproximación

            // En términos de pago: Se pagan 8 horas de trabajo, pero solo 7.5 son efectivas (13.33% más).
            const horasAbonarPorAdicional = horasNocturnasPorDia * ADICIONAL_NOCTURNO;

            // Total de horas que la empresa no abonó al 13.33% (solo por adicional, no por reducción efectiva)
            const diferenciaHorasNocturnas = horasNocturnasPorDia * ADICIONAL_NOCTURNO; // Horas a pagar al valor de la hora normal

            // --- CÁLCULO TOTAL ---
            
            // 1. Diferencia por Adicional Nocturno
            const totalAdicionalNocturno = diferenciaHorasNocturnas * valorHoraNormal * 30 * mesesAReclamar; // 30 días promedio de trabajo por mes

            // 2. Horas Extras 50% (Normales)
            const valorExtra50 = valorHoraNormal * 1.5;
            const totalExtras50 = horasExtrasNormales * valorExtra50 * mesesAReclamar;

            // 3. Horas Extras Feriados/100%
            const valorExtra100 = valorHoraNormal * 2.0;
            // Usamos las horas Extras Feriado ingresadas, más la conversión de Feriados Trabajados (asumiendo 8h por feriado)
            const horasFeriadoBase = feriadosTrabajados * 8; 
            const totalExtras100 = (horasExtrasFeriado + horasFeriadoBase) * valorExtra100 * mesesAReclamar;


            const totalDiferenciasSalariales = totalAdicionalNocturno + totalExtras50 + totalExtras100;
            currentDifferencesResult = {
                valorHoraNormal,
                horasNocturnasPorDia: horasNocturnasPorDia,
                totalAdicionalNocturno,
                totalExtras50,
                totalExtras100,
                totalDiferenciasSalariales
            };

            // Mostrar Resultados
            resultDiv.innerHTML = `
                <div class="space-y-3">
                    <h3 class="text-xl font-bold text-blue-700 border-b pb-2">Resumen de Diferencias Salariales (${mesesAReclamar} meses)</h3>
                    <div class="flex justify-between pb-1 text-sm text-gray-700">
                        <span class="font-medium">Valor Hora Normal (Est.):</span>
                        <span>${formatCurrency(valorHoraNormal)}</span>
                    </div>
                    <div class="flex justify-between pb-1 text-sm text-gray-700">
                        <span class="font-medium">Horas Nocturnas Est. por día:</span>
                        <span>${horasNocturnasPorDia} horas</span>
                    </div>
                    <hr class="my-3 border-gray-200">

                    <!-- Rubros Calculados -->
                    <div class="flex justify-between text-gray-700">
                        <span class="font-bold">Diferencia por Adicional Nocturno (13.33%):</span>
                        <span class="font-bold text-green-600">${formatCurrency(totalAdicionalNocturno)}</span>
                    </div>
                    <div class="flex justify-between text-gray-700">
                        <span class="font-bold">Diferencia por Horas Extras 50%:</span>
                        <span class="font-bold text-green-600">${formatCurrency(totalExtras50)}</span>
                    </div>
                    <div class="flex justify-between text-gray-700">
                        <span class="font-bold">Diferencia por Horas Extras/Feriados 100%:</span>
                        <span class="font-bold text-green-600">${formatCurrency(totalExtras100)}</span>
                    </div>
                    
                    <hr class="my-4 border-gray-500">
                    <div class="flex justify-between items-center bg-green-100 p-3 rounded-lg">
                        <span class="text-2xl font-extrabold text-green-800">TOTAL DIFERENCIAS:</span>
                        <span class="text-3xl font-extrabold text-green-800">${formatCurrency(totalDiferenciasSalariales)}</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Este cálculo es una estimación. Se asume un promedio de 30 días trabajados por mes.</p>
                </div>
            `;

        };

        const saveLiquidation = async () => { /* ... lógica de guardado ... */ };
        const loadHistory = () => { /* ... lógica de historial ... */ };
        const viewDetails = async (docId) => { /* ... lógica de detalles ... */ };

        // --- GENERACIÓN DE PDF ---
        const generatePDF = async () => {
            const PDFConstructor = window.jsPDF && window.jsPDF.jsPDF; // Referencia segura
            
            if (!currentLiquidationResult) {
                showModal("Error", "Debe calcular la liquidación primero.", "Presione el botón 'CALCULAR LIQUIDACIÓN' antes de intentar generar el PDF.");
                return;
            }

            if (!PDFConstructor) {
                showModal("Error", "Librería de PDF no disponible", "La librería de generación de PDF (jsPDF) no se cargó correctamente. Intente recargar la página o verificar su conexión.", 'error');
                return;
            }

            const doc = new PDFConstructor();
            const result = currentLiquidationResult;

            // ... (Resto del código de generación de PDF) ...
            
            // Guardar en DB y descargar
            saveLiquidation(); 
            
            const workerName = document.getElementById('worker-name').value;
            const safeWorkerName = workerName.trim().replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_') || 'Trabajador';
            doc.save(`Liquidacion_${safeWorkerName}_${new Date().toISOString().substring(0, 10)}.pdf`);
        };


        // --- UI Initialization ---
        const updateCurrentDate = () => {
            const today = new Date().toISOString().substring(0, 10);
            document.getElementById('fecha-egreso').value = today;
        };
        
        window.onload = () => {
            handleAuth();
            updateCurrentDate();
        };

        window.calculateSeverance = calculateSeverance;
        window.calculateSalaryDifferences = calculateSalaryDifferences;
        window.generatePDF = generatePDF;
        window.viewDetails = viewDetails;
        window.loadHistory = loadHistory;
        window.handleLogout = handleLogout;
        window.changeTab = changeTab; // Exponer la función de cambio de pestaña
        // ... (el resto del código de la aplicación y estilos) ...
    </script>
    <!-- ... (El resto del HEAD y BODY del HTML) ... -->
    <style>
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 450px; }
        body { font-family: 'Inter', sans-serif; background-color: #F8F8F8; color: #1F2937; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); padding: 1.5rem; margin-bottom: 1.5rem; }
        .btn-primary { background-color: #EF4444; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.2s; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .btn-primary:hover { background-color: #DC2626; }
        .btn-secondary { background-color: #3B82F6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.2s; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .btn-secondary:hover { background-color: #2563EB; }
        .input-style { padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.5rem; width: 100%; transition: border-color 0.2s; }
        .input-style:focus { border-color: #3B82F6; outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25); }
        th { background-color: #F3F4F6; text-align: left; font-weight: 600; color: #4B5563; border-bottom: 2px solid #E5E7EB; }
        .table-container { overflow-x: auto; border: 1px solid #E5E7EB; border-radius: 0.5rem; }
    </style>
</head>
<body class="min-h-screen">

    <div id="loading-spinner" class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-75 z-50 hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-red-600"></div>
        <p class="ml-4 text-white text-lg">Cargando...</p>
    </div>

    <div id="auth-screen" class="min-h-screen flex items-center justify-center p-4">
        <p class="text-xl font-medium text-gray-700">Iniciando sesión anónima para acceder a la aplicación...</p>
    </div>

    <div id="main-app" class="hidden">
        
        <header class="bg-white shadow-lg sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-red-600">Calculadora Laboral Argentina</h1>
                <div class="flex items-center space-x-4">
                    <span id="user-info" class="text-gray-600 text-sm truncate">Cargando ID...</span>
                    <button onclick="handleLogout()" class="bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-700 transition">Cerrar Sesión</button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

            <!-- Navegación por Pestañas -->
            <div class="flex mb-6 border-b border-gray-200">
                <button id="btn-indemnizacion" onclick="changeTab('indemnizacion')" class="px-6 py-3 text-sm font-semibold transition duration-150 border-r border-gray-200 rounded-tl-lg bg-red-600 text-white">
                    1. Liquidación Final (Indemnización)
                </button>
                <button id="btn-diferencias" onclick="changeTab('diferencias')" class="px-6 py-3 text-sm font-semibold text-red-600 transition duration-150 rounded-tr-lg hover:bg-gray-100">
                    2. Diferencias Salariales (Horas)
                </button>
            </div>
            
            <!-- PESTAÑA 1: CÁLCULO DE INDEMNIZACIÓN -->
            <div id="indemnizacion-tab" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Columna de Ingreso de Datos (Izquierda) -->
                <div class="lg:col-span-1">
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Datos del Trabajador</h2>
                        <form id="liquidation-form" onsubmit="event.preventDefault(); calculateSeverance()">
                            
                            <div class="mb-4">
                                <label for="worker-name" class="block text-sm font-medium text-gray-700 mb-1">Nombre y Apellido</label>
                                <input type="text" id="worker-name" required class="input-style" placeholder="Ej: Juan Pérez">
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="dni" class="block text-sm font-medium text-gray-700 mb-1">DNI</label>
                                    <input type="text" id="dni" class="input-style" placeholder="Ej: 12345678">
                                </div>
                                <div>
                                    <label for="cuit" class="block text-sm font-medium text-gray-700 mb-1">CUIT</label>
                                    <input type="text" id="cuit" class="input-style" placeholder="Ej: 20-12345678-9">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label for="cct" class="block text-sm font-medium text-gray-700 mb-1">CCT Aplicado</label>
                                    <input type="text" id="cct" class="input-style" placeholder="Ej: 130/75 (Comercio)">
                                </div>
                                <div>
                                    <label for="profesion" class="block text-sm font-medium text-gray-700 mb-1">Profesión</label>
                                    <input type="text" id="profesion" class="input-style" placeholder="Ej: Administrativo">
                                </div>
                            </div>

                            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Datos de Liquidación</h2>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="fecha-ingreso" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Ingreso</label>
                                    <input type="date" id="fecha-ingreso" required class="input-style">
                                </div>
                                <div>
                                    <label for="fecha-egreso" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Egreso</label>
                                    <input type="date" id="fecha-egreso" required class="input-style">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="sueldo" class="block text-sm font-medium text-gray-700 mb-1">MRMNyH (Sueldo)</label>
                                    <input type="number" id="sueldo" required class="input-style" placeholder="Sueldo Bruto" min="0">
                                </div>
                                <div>
                                    <label for="tope-salarial" class="block text-sm font-medium text-gray-700 mb-1">Tope Salarial (Art. 245)</label>
                                    <input type="number" id="tope-salarial" class="input-style" placeholder="Opcional: Dejar vacío si es igual al sueldo" min="0">
                                </div>
                            </div>
                            <div class="mb-6">
                                <label for="jornada" class="block text-sm font-medium text-gray-700 mb-1">Jornada (Horas Diarias)</label>
                                <input type="number" id="jornada" required class="input-style" placeholder="Ej: 8 (Jornada Completa)" min="1" max="8">
                                <p class="text-xs text-gray-500 mt-1">Si la jornada es reducida, el total se ajusta proporcionalmente.</p>
                            </div>
                            
                            <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">Selección de Multas y Sanciones</h2>
                            
                            <div class="space-y-2 mb-8">
                                <div class="mb-4">
                                    <input type="checkbox" id="fine-25323-2" class="rounded text-red-600 focus:ring-red-500">
                                    <label for="fine-25323-2" class="ml-2 text-sm font-medium text-gray-700">Art. 2 Ley 25.323 (50% de Indemnizaciones)</label>
                                </div>
                                <div class="mb-4">
                                    <input type="checkbox" id="fine-art-80" class="rounded text-red-600 focus:ring-red-500">
                                    <label for="fine-art-80" class="ml-2 text-sm font-medium text-gray-700">Art. 80 LCT (3 x MRMNyH - Certificados)</label>
                                </div>
                                <div class="mb-4">
                                    <input type="checkbox" id="fine-25323-1" class="rounded text-red-600 focus:ring-red-500">
                                    <label for="fine-25323-1" class="ml-2 text-sm font-medium text-gray-700">Art. 1 Ley 25.323 (10% - Relación no registrada - Placeholder)</label>
                                </div>
                            </div>

                            <button type="submit" class="w-full btn-primary transition transform hover:scale-[1.01] active:scale-[0.99]">
                                CALCULAR LIQUIDACIÓN
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Columna de Resultados e Historial (Derecha) -->
                <div class="lg:col-span-2">
                    
                    <!-- Resultados -->
                    <div class="card bg-gray-50">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Resultados</h2>
                        <div id="result-summary" class="min-h-[200px] flex items-center justify-center text-gray-500">
                            Presione "CALCULAR LIQUIDACIÓN" para ver el detalle.
                        </div>
                        <button id="pdf-button" onclick="generatePDF()" 
                                class="w-full mt-4 btn-secondary opacity-50 pointer-events-none transition transform hover:scale-[1.01] active:scale-[0.99]">
                            GENERAR PDF Y GUARDAR
                        </button>
                    </div>

                    <!-- Historial -->
                    <div class="card mt-8">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Historial de Liquidaciones</h2>
                        <div class="table-container">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="p-3 text-sm">Trabajador (DNI)</th>
                                        <th class="p-3 text-sm">Fecha Egreso</th>
                                        <th class="p-3 text-sm">Total Estimado</th>
                                        <th class="p-3 text-sm text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Filas de historial se insertan aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <!-- PESTAÑA 2: CÁLCULO DE DIFERENCIAS SALARIALES -->
            <div id="diferencias-salariales-tab" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Columna de Ingreso de Datos -->
                <div class="lg:col-span-1">
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Base de Cálculo</h2>
                        <form onsubmit="event.preventDefault(); calculateSalaryDifferences()">
                            
                            <div class="mb-4">
                                <label for="sueldo-mensual" class="block text-sm font-medium text-gray-700 mb-1">Sueldo Bruto Mensual (MRMNyH)</label>
                                <input type="number" id="sueldo-mensual" required class="input-style" placeholder="Sueldo base para calcular la hora" min="0">
                            </div>
                            <div class="mb-6">
                                <label for="meses-reclamar" class="block text-sm font-medium text-gray-700 mb-1">Meses a Reclamar (Máx. 24)</label>
                                <input type="number" id="meses-reclamar" required class="input-style" placeholder="Ej: 24" min="1" max="24" value="24">
                            </div>

                            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Patrón de Horarios</h2>
                            <p class="text-xs text-gray-500 mb-4">Ingrese su horario habitual para calcular automáticamente las horas nocturnas (21:00 a 06:00).</p>

                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label for="hora-entrada" class="block text-sm font-medium text-gray-700 mb-1">Hora de Entrada (24h)</label>
                                    <input type="time" id="hora-entrada" required class="input-style" value="14:00">
                                </div>
                                <div>
                                    <label for="hora-salida" class="block text-sm font-medium text-gray-700 mb-1">Hora de Salida (24h)</label>
                                    <input type="time" id="hora-salida" required class="input-style" value="23:00">
                                </div>
                            </div>
                            
                            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Horas Adicionales No Abonadas</h2>
                            <p class="text-xs text-gray-500 mb-4">Ingrese los totales aproximados en el período de reclamo (ej: 24 meses).</p>

                            <div class="mb-4">
                                <label for="horas-extras-normales" class="block text-sm font-medium text-gray-700 mb-1">Horas Extras al 50% (No abonadas)</label>
                                <input type="number" id="horas-extras-normales" class="input-style" placeholder="Total de horas extras simples" min="0">
                                <p class="text-xs text-gray-500 mt-1">Horas en días normales y sábados (hasta 13hs).</p>
                            </div>
                            <div class="mb-4">
                                <label for="horas-extras-feriado" class="block text-sm font-medium text-gray-700 mb-1">Horas Extras al 100% (No abonadas)</label>
                                <input type="number" id="horas-extras-feriado" class="input-style" placeholder="Total de horas extras dobles" min="0">
                                <p class="text-xs text-gray-500 mt-1">Horas en días de descanso o sábados después de 13hs.</p>
                            </div>
                            <div class="mb-8">
                                <label for="feriados-trabajados" class="block text-sm font-medium text-gray-700 mb-1">Feriados (Días completos no abonados)</label>
                                <input type="number" id="feriados-trabajados" class="input-style" placeholder="Cantidad de días feriados completos trabajados" min="0">
                                <p class="text-xs text-gray-500 mt-1">Asumiremos 8 horas por cada día feriado.</p>
                            </div>
                            

                            <button type="submit" class="w-full btn-primary transition transform hover:scale-[1.01] active:scale-[0.99] bg-green-600 hover:bg-green-700">
                                CALCULAR DIFERENCIAS SALARIALES
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Columna de Resultados -->
                <div class="lg:col-span-2">
                    <div class="card bg-gray-50">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Resultado de Diferencias</h2>
                        <div id="result-diferencias" class="min-h-[200px] flex items-center justify-center text-gray-500">
                            Ingrese los datos y presione "CALCULAR DIFERENCIAS SALARIALES".
                        </div>
                        <button id="pdf-diferencias-button" disabled
                                class="w-full mt-4 btn-secondary opacity-50 pointer-events-none transition transform hover:scale-[1.01] active:scale-[0.99]">
                            GENERAR INFORME (Próximamente)
                        </button>
                    </div>
                    
                </div>
            </div>


        </main>
    </div>

    <!-- Modal General -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg transform transition-all duration-300 scale-100">
            <h3 id="modal-title" class="text-xl font-bold mb-4 text-red-600"></h3>
            <div id="modal-content" class="text-gray-700 mb-6 max-h-96 overflow-y-auto"></div>
            <button onclick="hideModal()" class="w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">Aceptar</button>
        </div>
    </div>

</body>
</html>
